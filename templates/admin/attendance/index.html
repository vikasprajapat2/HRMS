{% extends "base.html" %}
{% block title %}Attendance Management{% endblock %}
{% block content %}
<h2>Attendance Management - {{ date }}</h2>

<div style="margin-bottom:12px;">
  <a class="btn btn-primary" href="{{ url_for('attendance.board') }}">Attendance Board</a>
  <a class="btn btn-success" href="{{ url_for('attendance.create') }}">Add Record</a>
  <a class="btn btn-info" href="{{ url_for('attendance.monthly_report') }}">Monthly Report</a>
  <a class="btn btn-secondary" href="{{ url_for('attendance.holidays') }}">Manage Holidays</a>
</div><form method="get" action="{{ url_for('attendance.index') }}" style="margin-bottom:12px;">
	<label for="date">Date:</label>
	<input type="date" id="date" name="date" value="{{ date }}">
	<button class="btn btn-sm btn-secondary" type="submit">Filter</button>
</form>

<table class="table" style="width:100%; border-collapse: collapse;">
	<thead>
		<tr>
			<th style="border:1px solid #ddd;padding:8px;">#</th>
			<th style="border:1px solid #ddd;padding:8px;">Employee</th>
			<th style="border:1px solid #ddd;padding:8px;">Status</th>
			<th style="border:1px solid #ddd;padding:8px;">Time In</th>
			<th style="border:1px solid #ddd;padding:8px;">Time Out</th>
			<th style="border:1px solid #ddd;padding:8px;">Actions</th>
		</tr>
	</thead>
	<tbody>
		{% if attendances %}
			{% for a in attendances %}
			<tr>
				<td style="border:1px solid #ddd;padding:8px;">{{ loop.index }}</td>
				<td style="border:1px solid #ddd;padding:8px;">{{ a.employee.firstname }} {{ a.employee.lastname }}</td>
				<td style="border:1px solid #ddd;padding:8px;">
                    {% if a.status == 'present' %}
                        <span class="badge bg-success text-white">Present</span>
                    {% elif a.status == 'absent' %}
                        <span class="badge bg-danger text-white">Absent</span>
                    {% elif a.status == 'holiday' %}
                        <span class="badge bg-info text-white" title="{{ a.description }}">Holiday</span>
                    {% elif a.status == 'weekend' %}
                        <span class="badge bg-secondary text-white">Weekend</span>
                    {% elif a.status == 'leave' %}
                        <span class="badge bg-warning text-white" title="{{ a.description }}">Leave</span>
                    {% else %}
                        <span class="badge bg-secondary text-white">{{ a.status }}</span>
                    {% endif %}
                    {% if a.description %}
                        <small class="text-muted d-block">{{ a.description }}</small>
                    {% endif %}
                </td>
				<td style="border:1px solid #ddd;padding:8px;">{{ a.time_in or '-' }}</td>
				<td style="border:1px solid #ddd;padding:8px;">{{ a.time_out or '-' }}</td>
				<td style="border:1px solid #ddd;padding:8px;">
                    {% if a.status not in ['holiday', 'weekend'] %}
                        <a class="btn btn-sm btn-info" href="{{ url_for('attendance.edit', attendance_id=a.id) }}">Edit</a>
                        <form method="post" action="{{ url_for('attendance.delete', attendance_id=a.id) }}" style="display:inline-block;margin-left:6px;">
                            <button class="btn btn-sm btn-danger" type="submit" onclick="return confirm('Delete this record?')">Delete</button>
                        </form>
                    {% endif %}
				</td>
			</tr>
			{% endfor %}
		{% else %}
			<tr><td colspan="6" style="padding:8px;">No attendance records for this date.</td></tr>
		{% endif %}
	</tbody>
</table>

{% endblock %}
